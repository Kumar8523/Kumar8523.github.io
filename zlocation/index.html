<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOID | ATLAS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS (Map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        void: '#050505',
                        panel: '#0f0f0f',
                        neon: '#D4FF00', // Acid Green
                        subtle: '#333333',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e5e5e5;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        /* Map Dark Mode Filter */
        .leaflet-layer {
            filter: invert(100%) hue-rotate(180deg) brightness(85%) contrast(90%) grayscale(100%);
        }
        
        /* Grid Background Pattern */
        .bg-grid {
            background-image: linear-gradient(to right, #1a1a1a 1px, transparent 1px),
                              linear-gradient(to bottom, #1a1a1a 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Utilities */
        .data-card {
            background: #0f0f0f;
            border: 1px solid #1f1f1f;
            transition: border-color 0.3s ease;
        }
        .data-card:hover {
            border-color: #333;
        }

        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .loader-bar {
            height: 2px;
            width: 100%;
            background: #1f1f1f;
            overflow: hidden;
            position: relative;
        }
        .loader-bar::after {
            content: '';
            position: absolute;
            left: -50%;
            height: 100%;
            width: 50%;
            background: #D4FF00;
            animation: loading 1.5s infinite ease-in-out;
        }
        @keyframes loading {
            0% { left: -50%; width: 30%; }
            50% { width: 60%; }
            100% { left: 100%; width: 30%; }
        }
    </style>
</head>
<body class="bg-void min-h-screen flex flex-col bg-grid">

    <!-- Top Navigation / Status Bar -->
    <nav class="w-full border-b border-subtle/30 bg-void/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-3 h-3 bg-neon rounded-full blink"></div>
                <h1 class="font-sans font-bold text-xl tracking-tight uppercase">Void<span class="text-neon">Atlas</span></h1>
            </div>
            <div class="font-mono text-xs text-gray-500 hidden sm:block" id="system-time">INIT_SYSTEM...</div>
        </div>
        <div id="global-loader" class="loader-bar hidden"></div>
    </nav>

    <!-- Main Dashboard -->
    <main class="flex-grow p-4 md:p-6 lg:p-8 max-w-7xl mx-auto w-full">
        
        <!-- Controls & Identity -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-4">
            <!-- IP & Identity (Takes up 8 cols) -->
            <div class="md:col-span-8 data-card rounded-lg p-6 relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-5">
                    <i data-lucide="fingerprint" class="w-32 h-32"></i>
                </div>
                
                <div class="flex flex-col h-full justify-between">
                    <div>
                        <p class="font-mono text-xs text-gray-500 uppercase mb-2">Public Identity Node</p>
                        <h2 id="ip-address" class="font-mono text-3xl md:text-5xl text-white font-bold tracking-tighter">Scanning...</h2>
                    </div>
                    
                    <div class="mt-8 grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <div>
                            <p class="text-[10px] text-gray-500 uppercase font-mono">ISP / ORG</p>
                            <p id="isp-name" class="text-sm font-sans font-medium text-gray-300">---</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-500 uppercase font-mono">Connection</p>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 bg-neon rounded-full"></span>
                                <p class="text-sm font-sans font-medium text-gray-300">Active</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-500 uppercase font-mono">Type</p>
                            <p id="net-type" class="text-sm font-sans font-medium text-gray-300">IPv4</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Center (Takes up 4 cols) -->
            <div class="md:col-span-4 flex flex-col gap-4">
                <button onclick="getUserLocation()" class="flex-1 data-card rounded-lg p-4 flex items-center justify-between group hover:bg-[#151515] transition-colors cursor-pointer text-left">
                    <div>
                        <h3 class="font-sans font-bold text-white flex items-center gap-2">
                            <i data-lucide="crosshair" class="w-4 h-4 text-neon"></i> Locate Me
                        </h3>
                        <p class="text-xs text-gray-500 mt-1">Activate GPS for precision</p>
                    </div>
                    <i data-lucide="chevron-right" class="text-gray-600 group-hover:text-neon transition-colors"></i>
                </button>

                <button onclick="runSpeedTest()" id="speed-btn" class="flex-1 data-card rounded-lg p-4 flex items-center justify-between group hover:bg-[#151515] transition-colors cursor-pointer text-left">
                    <div>
                        <h3 class="font-sans font-bold text-white flex items-center gap-2">
                            <i data-lucide="zap" class="w-4 h-4 text-neon"></i> Speed Test
                        </h3>
                        <p id="speed-status" class="text-xs text-gray-500 mt-1">Check Latency & DL</p>
                    </div>
                    <span id="speed-result" class="font-mono text-neon font-bold text-lg">--</span>
                </button>
            </div>
        </div>

        <!-- Geographic Data -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
            <div class="data-card rounded-lg p-4">
                <i data-lucide="map-pin" class="w-5 h-5 text-gray-600 mb-3"></i>
                <p class="text-[10px] text-gray-500 uppercase font-mono">Country</p>
                <p id="country-data" class="text-lg font-sans font-bold text-white truncate">---</p>
            </div>
            <div class="data-card rounded-lg p-4">
                <i data-lucide="building-2" class="w-5 h-5 text-gray-600 mb-3"></i>
                <p class="text-[10px] text-gray-500 uppercase font-mono">Region/City</p>
                <p id="city-data" class="text-lg font-sans font-bold text-white truncate">---</p>
            </div>
            <div class="data-card rounded-lg p-4">
                <i data-lucide="banknote" class="w-5 h-5 text-gray-600 mb-3"></i>
                <p class="text-[10px] text-gray-500 uppercase font-mono">Currency</p>
                <p id="currency-data" class="text-lg font-sans font-bold text-white">---</p>
            </div>
            <div class="data-card rounded-lg p-4">
                <i data-lucide="clock" class="w-5 h-5 text-gray-600 mb-3"></i>
                <p class="text-[10px] text-gray-500 uppercase font-mono">Local Time</p>
                <p id="timezone-data" class="text-lg font-sans font-bold text-white">---</p>
            </div>
        </div>

        <!-- Map Module -->
        <div class="w-full data-card rounded-lg p-1 h-[400px] relative mb-4">
            <div id="map" class="w-full h-full rounded bg-[#0a0a0a] z-0"></div>
            
            <!-- Coordinates Overlay -->
            <div class="absolute bottom-4 left-4 z-[999] bg-void/90 border border-white/10 p-3 rounded backdrop-blur-sm">
                <div class="flex gap-4 font-mono text-xs">
                    <div>
                        <span class="text-gray-500 block">LAT</span>
                        <span id="lat-val" class="text-neon">00.0000</span>
                    </div>
                    <div>
                        <span class="text-gray-500 block">LNG</span>
                        <span id="lng-val" class="text-neon">00.0000</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Address Module -->
        <div class="data-card rounded-lg p-6 border-l-4 border-l-neon">
            <p class="text-[10px] text-gray-500 uppercase font-mono mb-2">Detected Physical Address</p>
            <p id="address-val" class="font-sans text-xl md:text-2xl text-white leading-relaxed">
                Waiting for GPS Authorization...
            </p>
            <div class="mt-4 flex gap-2">
                <span class="px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400 font-mono border border-white/5">OSM NOMINATIM</span>
                <span class="px-2 py-1 bg-white/5 rounded text-[10px] text-gray-400 font-mono border border-white/5">WGS84</span>
            </div>
        </div>

    </main>

    <footer class="text-center py-6 text-gray-600 text-xs font-mono">
        SYSTEM READY // VOID_ATLAS V2.0 // NO LOGS KEPT
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Init Icons
        lucide.createIcons();

        // Constants & State
        let mapInstance = null;
        let mapMarker = null;
        const loader = document.getElementById('global-loader');

        // Update System Time
        setInterval(() => {
            const now = new Date();
            document.getElementById('system-time').innerText = now.toISOString().replace('T', ' ').split('.')[0];
        }, 1000);

        // UI Helpers
        const toggleLoader = (show) => loader.classList.toggle('hidden', !show);
        const setText = (id, text) => {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
        };

        // 1. Initialize & Get IP Data (Auto)
        async function initSystem() {
            toggleLoader(true);
            try {
                // Using ipapi.co (JSON format)
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                
                if (data.error) throw new Error(data.reason);

                // Populate Data
                setText('ip-address', data.ip);
                setText('isp-name', data.org || data.asn);
                setText('country-data', data.country_name);
                setText('city-data', `${data.city}, ${data.region_code}`);
                setText('currency-data', data.currency);
                setText('timezone-data', data.utc_offset);
                
                // Update Coords & Map (Initial Approximation)
                updateMap(data.latitude, data.longitude, false);
                
                // Get approximate address
                getAddress(data.latitude, data.longitude, false);

            } catch (err) {
                console.error(err);
                setText('ip-address', "NET_ERR");
                setText('isp-name', "Blocked by Client/Ext");
            } finally {
                toggleLoader(false);
            }
        }

        // 2. Map Logic
        function updateMap(lat, lng, isPrecise) {
            setText('lat-val', lat.toFixed(5));
            setText('lng-val', lng.toFixed(5));

            if (!mapInstance) {
                mapInstance = L.map('map', { zoomControl: false }).setView([lat, lng], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap',
                    maxZoom: 19
                }).addTo(mapInstance);
            } else {
                mapInstance.flyTo([lat, lng], 16);
            }

            if (mapMarker) mapInstance.removeLayer(mapMarker);

            // Custom Marker Style
            const color = isPrecise ? '#D4FF00' : '#666666';
            const customIcon = L.divIcon({
                className: 'custom-pin',
                html: `<div style="
                    width: 16px; 
                    height: 16px; 
                    background: ${color}; 
                    border: 2px solid #000; 
                    border-radius: 50%;
                    box-shadow: 0 0 15px ${color};">
                </div>`,
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            });

            mapMarker = L.marker([lat, lng], { icon: customIcon }).addTo(mapInstance);
        }

        // 3. Precise Geolocation (GPS)
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation not supported");
                return;
            }

            toggleLoader(true);
            setText('address-val', "Acquiring Satellite Lock...");

            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const { latitude, longitude } = pos.coords;
                    updateMap(latitude, longitude, true);
                    getAddress(latitude, longitude, true);
                    toggleLoader(false);
                },
                (err) => {
                    toggleLoader(false);
                    setText('address-val', "GPS Permission Denied.");
                },
                { enableHighAccuracy: true }
            );
        }

        // 4. Reverse Geocoding (Address)
        async function getAddress(lat, lng, isReal) {
            try {
                const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`;
                const res = await fetch(url);
                const data = await res.json();
                
                const prefix = isReal ? "[GPS CONFIRMED] " : "[IP APPROX] ";
                setText('address-val', prefix + (data.display_name || "Ocean/Unknown"));
            } catch (e) {
                setText('address-val', "Address Server Unreachable");
            }
        }

        // 5. Speed Test (Download Simulation)
        async function runSpeedTest() {
            const btn = document.getElementById('speed-btn');
            const resultDisplay = document.getElementById('speed-result');
            const statusDisplay = document.getElementById('speed-status');
            
            if (btn.classList.contains('opacity-50')) return;
            
            // UI State: Running
            btn.classList.add('opacity-50');
            statusDisplay.innerText = "Downloading packets...";
            resultDisplay.innerText = "0.0";
            toggleLoader(true);

            const imageAddr = "https://upload.wikimedia.org/wikipedia/commons/2/2d/Snake_River_%285mb%29.jpg"; 
            const downloadSize = 5245329; // Bytes
            const startTime = (new Date()).getTime();
            const cacheBuster = "?nnn=" + startTime;

            try {
                const download = new Image();
                download.onload = function () {
                    const endTime = (new Date()).getTime();
                    const duration = (endTime - startTime) / 1000;
                    
                    const bitsLoaded = downloadSize * 8;
                    const speedBps = bitsLoaded / duration;
                    const speedMbps = (speedBps / (1024 * 1024)).toFixed(2);
                    
                    // UI State: Done
                    resultDisplay.innerText = speedMbps + " Mbps";
                    statusDisplay.innerText = "Test Complete";
                    btn.classList.remove('opacity-50');
                    toggleLoader(false);
                };

                download.onerror = function () {
                    resultDisplay.innerText = "ERR";
                    statusDisplay.innerText = "Network Error";
                    btn.classList.remove('opacity-50');
                    toggleLoader(false);
                };

                download.src = imageAddr + cacheBuster;
            } catch (e) {
                resultDisplay.innerText = "ERR";
                toggleLoader(false);
            }
        }

        // Run on load
        window.addEventListener('load', initSystem);

    </script>
</body>
</html>


